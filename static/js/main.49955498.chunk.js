(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{21:function(t,e,a){},22:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a(2),i=a.n(s),o=a(14),c=a.n(o),r=(a(21),a(9)),h=a(6),l=a(1),u=a(3),j=a(5),d=a(4),m=a(13),b="#3f51b5",f="#757de8",g="#ffffff",v="#ffffff",p=function(){return Object(n.jsx)("div",{className:"header",style:{backgroundColor:b,color:g},children:"Ray Tracer"})},O=a.p+"static/media/play.f8ecb826.svg",x=function(t){var e=t.sceneName,a=t.gamma,s=t.resolution,o=t.reflections,c=t.onParamChange,r=t.onStart,h=t.loading;return Object(n.jsxs)(i.a.Fragment,{children:[Object(n.jsxs)("div",{className:"content",style:{textAlign:"center"},children:[Object(n.jsx)("h2",{children:"Rust + WebAssembly Path Tracer"}),Object(n.jsx)("h3",{children:"Author"}),Object(n.jsx)("span",{children:"Alessandro Genova"}),Object(n.jsx)("h3",{children:"Core Library"}),Object(n.jsxs)("span",{children:[Object(n.jsx)("a",{href:"https://github.com/alesgenova/ray-tracer",target:"_blank",children:"Source"}),Object(n.jsx)("br",{}),"(rust)"]}),Object(n.jsx)("h3",{children:"Demo App"}),Object(n.jsxs)("span",{children:[Object(n.jsx)("a",{href:"https://github.com/alesgenova/ray-tracer-app",target:"_blank",children:"Source"}),Object(n.jsx)("br",{}),"(wasm, react)"]}),Object(n.jsx)("br",{}),Object(n.jsx)("h3",{children:"Scene"}),Object(n.jsxs)("select",{value:e,onChange:function(t){c("sceneName",t.target.value)},children:[Object(n.jsx)("option",{value:"random",children:"Random"}),Object(n.jsx)("option",{value:"room",children:"Room"})]}),Object(n.jsx)("h3",{children:"Resolution"}),Object(n.jsxs)("select",{value:s,onChange:function(t){c("resolution",t.target.value)},children:[Object(n.jsx)("option",{value:10,children:"".concat(160," x ").concat(90)}),Object(n.jsx)("option",{value:20,children:"".concat(320," x ").concat(180)}),Object(n.jsx)("option",{value:40,children:"".concat(640," x ").concat(360)}),Object(n.jsx)("option",{value:80,children:"".concat(1280," x ").concat(720)})]}),Object(n.jsx)("h3",{children:"Reflections"}),Object(n.jsxs)("select",{value:o,onChange:function(t){c("reflections",t.target.value)},children:[Object(n.jsx)("option",{value:2,children:"2"}),Object(n.jsx)("option",{value:4,children:"4"}),Object(n.jsx)("option",{value:8,children:"8"}),Object(n.jsx)("option",{value:16,children:"16"})]}),Object(n.jsx)("h3",{children:"Gamma"}),Object(n.jsxs)("select",{value:a,onChange:function(t){c("gamma",t.target.value)},children:[Object(n.jsx)("option",{value:1,children:"1.0"}),Object(n.jsx)("option",{value:1.5,children:"1.5"}),Object(n.jsx)("option",{value:2,children:"2.0"}),Object(n.jsx)("option",{value:2.5,children:"2.5"}),Object(n.jsx)("option",{value:3,children:"3.0"})]})]}),Object(n.jsx)("div",{className:"floating-container-center",children:Object(n.jsx)("button",{disabled:h,onClick:r,className:"floating-button-large",style:{backgroundColor:h?f:b,color:g},children:Object(n.jsx)("img",{src:O})})})]})},k=a.p+"static/media/stop.2f57eafa.svg",w=a.p+"static/media/pause.917fd899.svg",y=function(t){Object(j.a)(a,t);var e=Object(d.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).computePixel=function(t){return new Promise((function(e){var a=new Float64Array(3),s=Math.floor(t/n.width),i=t%n.width;n.renderer.render_pixel(i,s,n.scene,n.camera,a),e({i:s,j:i,color:a})}))},n.mainLoop=function(t){if(n.iteration=t,!(n.pause||t>n.maxIteration)){for(var e=n.props.workerPool,a=[],s=n.width*n.height,i=0,o=Math.min(s,i+n.chunkSize),c=new Date,r=function(){var c=i,r=o;a.push(e.call("renderChunk",c,r,t).then((function(e){n.updateImage(c,r,t,e),n.updateCanvas(n.image)}))),i=o,o=Math.min(s,i+n.chunkSize)};i<s;)r();Promise.all(a).then((function(){var e=new Date;console.log("All tasks done!",t,"Elapsed: ",(e-c)/1e3),requestAnimationFrame((function(){n.mainLoop(t+1)}))}))}},n.onPause=function(){var t=n.pause;n.pause=!t,t&&n.mainLoop(n.iteration),n.setState((function(e){return e.pause=!t,e}))},n.state={pause:!1},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var t=this,e=this.props,a=e.width,n=e.height,s=e.sceneName,i=e.reflections,o=e.workerPool;this.pause=!1,this.width=a,this.height=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.imageData=this.context.createImageData(this.width,this.height),this.imageElement.src=this.canvas.toDataURL(),this.image=new Float64Array(this.width*this.height*3),this.chunkSize=2e3,this.maxIteration=256;var c=Math.floor(2147483646*Math.random());Promise.all(o.broadcast("initialize",s,a,n,i,c)).then((function(){t.mainLoop(-1)}))}},{key:"componentDidUpdate",value:function(){this.context=this.canvas.getContext("2d"),this.imageData=this.context.createImageData(this.width,this.height)}},{key:"componentWillUnmount",value:function(){this.pause=!0}},{key:"updateImage",value:function(t,e,a,n){for(var s=1/((a=Math.max(0,a))+1),i=0;i<e-t;++i)for(var o=i+t,c=0;c<3;++c)this.image[3*o+c]=(1-s)*this.image[3*o+c]+s*n[3*i+c]}},{key:"updateCanvas",value:function(t){for(var e=1/this.props.gamma,a=0;a<this.width*this.height;++a)this.imageData.data[4*a]=255*Math.pow(t[3*a],e),this.imageData.data[4*a+1]=255*Math.pow(t[3*a+1],e),this.imageData.data[4*a+2]=255*Math.pow(t[3*a+2],e),this.imageData.data[4*a+3]=255;this.context.putImageData(this.imageData,0,0),this.imageElement&&(this.imageElement.src=this.canvas.toDataURL())}},{key:"render",value:function(){var t=this,e=this.props.onStop,a=this.state.pause;return Object(n.jsxs)(i.a.Fragment,{children:[Object(n.jsx)("div",{className:"content",style:{textAlign:"center"},children:Object(n.jsx)("img",{style:{width:"100%"},ref:function(e){t.imageElement=e}})}),Object(n.jsxs)("div",{className:"floating-container-center",children:[Object(n.jsx)("button",{onClick:this.onPause,className:"floating-button-large",style:{backgroundColor:f,color:v,marginRight:"1rem"},children:Object(n.jsx)("img",{src:a?O:w})}),Object(n.jsx)("button",{onClick:e,className:"floating-button-large",style:{backgroundColor:"#9c27b0",color:v},children:Object(n.jsx)("img",{src:k})})]})]})}}]),a}(s.Component),C=a(11),_=a(15),P=function(){function t(e){var a=this;Object(l.a)(this,t),this._workers=void 0,this._status=void 0,this._tasks=void 0,this._workers=e,this._tasks=[],this._status={},this._workers.forEach((function(t,e){a._status[e]=0}))}return Object(u.a)(t,[{key:"call",value:function(t){for(var e=this,a=arguments.length,n=new Array(a>1?a-1:0),s=1;s<a;s++)n[s-1]=arguments[s];return new Promise((function(a,s){e._tasks.push({methodName:t,args:n,resolve:a,reject:s}),e.popTask()}))}},{key:"broadcast",value:function(t){for(var e=this,a=arguments.length,n=new Array(a>1?a-1:0),s=1;s<a;s++)n[s-1]=arguments[s];var i=[];return this._workers.forEach((function(a,s){i.push(new Promise((function(a,i){e.executeTask(s,{methodName:t,args:n,resolve:a,reject:i})})))})),i}},{key:"popTask",value:function(){var t;if(0!==this._tasks.length&&(Object.entries(this._status).forEach((function(e){var a=Object(_.a)(e,2),n=a[0];0===a[1]&&(t=parseInt(n))})),void 0!==t)){var e=this._tasks[0];this._tasks=this._tasks.slice(1,this._tasks.length),this.executeTask(t,e)}}},{key:"executeTask",value:function(t,e){var a,n=this;this._status[t]+=1;var s=e.methodName,i=e.args,o=e.resolve,c=e.reject;(a=this._workers[t].remoteHandle()).call.apply(a,[s].concat(Object(C.a)(i))).then((function(e){o(e),n._status[t]-=1,n.popTask()})).catch((function(e){c(e),n._status[t]-=1,n.popTask()}))}}]),t}(),S=function(t){Object(j.a)(a,t);var e=Object(d.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).onStart=function(){n.setState((function(t){return Object(h.a)(Object(h.a)({},t),{},{loaded:!0})}))},n.onStop=function(){n.setState((function(t){return Object(h.a)(Object(h.a)({},t),{},{loaded:!1})}))},n.onParamChange=function(t,e){n.setState((function(a){return Object(h.a)(Object(h.a)({},a),{},Object(r.a)({},t,e))}))},n.state={sceneName:"random",resolution:20,reflections:8,loading:!0,loaded:!1,gamma:2,workerPool:void 0},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){for(var t=this,e=[],a=0;a<2;++a){var n=new Worker("".concat("/ray-tracer-app","/ray-tracer/worker.js")),s=new m.b({worker:n});e.push(Object(m.a)(s,{},10,1e3))}Promise.all(e).then((function(e){var a=new P(e);t.setState((function(t){return Object(h.a)(Object(h.a)({},t),{},{workerPool:a,loading:!1})}))}))}},{key:"render",value:function(){var t=this.state,e=t.sceneName,a=t.resolution,s=t.reflections,i=t.gamma,o=t.workerPool,c=t.loaded,r=t.loading;return Object(n.jsxs)("div",{className:"app",style:{backgroundColor:"#F5F5F5"},children:[Object(n.jsx)(p,{}),Object(n.jsxs)("div",{className:"content-container",children:[!c&&Object(n.jsx)(x,{sceneName:e,resolution:a,reflections:s,gamma:i,onParamChange:this.onParamChange,onStart:this.onStart,loading:r}),c&&o&&Object(n.jsx)(y,{sceneName:e,workerPool:o,width:16*a,height:9*a,reflections:s,gamma:i,onStop:this.onStop})]})]})}}]),a}(i.a.Component),N=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,23)).then((function(e){var a=e.getCLS,n=e.getFID,s=e.getFCP,i=e.getLCP,o=e.getTTFB;a(t),n(t),s(t),i(t),o(t)}))};c.a.render(Object(n.jsx)(i.a.StrictMode,{children:Object(n.jsx)(S,{})}),document.getElementById("root")),N()}},[[22,1,2]]]);
//# sourceMappingURL=main.49955498.chunk.js.map